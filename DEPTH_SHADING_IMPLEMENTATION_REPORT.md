# é€æ˜åŒ–ãƒ¢ãƒ¼ãƒ‰é€£å‹•ãƒ»å¥¥è¡Œãæš—åŒ–è‡ªå‹•é©ç”¨ å®Ÿè£…ãƒ¬ãƒãƒ¼ãƒˆ

**å®Ÿè£…æ—¥**: 2025-11-08  
**ãƒ–ãƒ©ãƒ³ãƒ**: `manus/depth-shading`  
**ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒ**: `manus/zodiac-switch`  
**ã‚³ãƒŸãƒƒãƒˆ**: `1e76eb6`

---

## âœ… å®Ÿè£…å®Œäº†

é€æ˜åŒ–ãƒ¢ãƒ¼ãƒ‰é€£å‹•ãƒ»å¥¥è¡Œãæš—åŒ–è‡ªå‹•é©ç”¨æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

---

## ğŸ“‹ å®Ÿè£…å†…å®¹

### 1. åŸºæœ¬å¤‰æ•°ã®è¿½åŠ 

#### applyDepthShadingå¤‰æ•°
```javascript
let applyDepthShading = false; // â˜… ADDED: å¥¥è¡Œãæš—åŒ–ãƒ¢ãƒ¼ãƒ‰ï¼ˆè£å´æç”»ã¨é€£å‹•ï¼‰
```

- **åˆæœŸå€¤**: `false`
- **é€£å‹•**: `showBackSide` ã¨è‡ªå‹•åŒæœŸ
- **æ°¸ç¶šåŒ–**: localStorageã«ä¿å­˜

#### ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ä¿®æ­£
```javascript
backToggle.addEventListener('change', () => { 
  showBackSide = backToggle.checked; 
  applyDepthShading = backToggle.checked; // â˜… ADDED: è£å´æç”»ã¨å¥¥è¡Œãæš—åŒ–ã‚’é€£å‹•
  saveSettings(); 
  requestRender(); 
});
```

---

### 2. projecté–¢æ•°ã®ä¿®æ­£

#### ä¿®æ­£å‰
```javascript
function project(x, y, z) {
  if (!showBackSide && x < 0) return null;
  const effectiveY = reverseEastWest ? -y : y;
  const sx = centerX + scale * effectiveY;
  const sy = centerY - scale * z;
  return { sx, sy };
}
```

#### ä¿®æ­£å¾Œ
```javascript
function project(x, y, z) {
  const isBackSide = x < 0; // Xè»¸ãŒå¥¥è¡Œãï¼ˆè² =å¥¥å´ï¼‰
  if (!showBackSide && isBackSide) return null;
  const effectiveY = reverseEastWest ? -y : y;
  const sx = centerX + scale * effectiveY;
  const sy = centerY - scale * z;
  return { sx, sy, isBackSide }; // â˜… ADDED: isBackSideãƒ•ãƒ©ã‚°ã‚’è¿”ã™
}
```

**å¤‰æ›´ç‚¹**:
- `isBackSide` ãƒ•ãƒ©ã‚°ã‚’è¨ˆç®—ï¼ˆ`x < 0` ã§åˆ¤å®šï¼‰
- æˆ»ã‚Šå€¤ã« `isBackSide` ã‚’è¿½åŠ 

**é‡è¦**: åº§æ¨™ç³»ã¯ **Xè»¸ãŒå¥¥è¡Œã**ï¼ˆä»•æ§˜æ›¸ã®Zè»¸ã®èª¤ã‚Šã‚’ä¿®æ­£ï¼‰

---

### 3. drawStarsé–¢æ•°ã®ä¿®æ­£ï¼ˆãƒãƒƒãƒæç”»æœ€é©åŒ–ç¶­æŒï¼‰

#### ä¿®æ­£å‰
```javascript
const key = `${color}_${size}`;

if (!starGroups.has(key)) {
  starGroups.set(key, { color, size, points: [] });
}
```

#### ä¿®æ­£å¾Œ
```javascript
// â˜… ADDED: å¥¥è¡Œãæš—åŒ–ãƒ¢ãƒ¼ãƒ‰æ™‚ã¯Î±ã‚’è¨ˆç®—
const alpha = (applyDepthShading && p.isBackSide) ? 0.4 : 1.0;
const key = `${color}_${size}_${alpha}`; // Î±ã‚‚ã‚­ãƒ¼ã«å«ã‚ã‚‹

if (!starGroups.has(key)) {
  starGroups.set(key, { color, size, alpha, points: [] });
}

// ã‚°ãƒ«ãƒ¼ãƒ—æç”»æ™‚
ctx.globalAlpha = group.alpha; // â˜… ADDED: ã‚°ãƒ«ãƒ¼ãƒ—å˜ä½ã§Î±è¨­å®š
```

**æœ€é©åŒ–**:
- Î±ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã®ã‚­ãƒ¼ã«å«ã‚ã‚‹ã“ã¨ã§ã€ãƒãƒƒãƒæç”»ã‚’ç¶­æŒ
- å„æ˜Ÿã”ã¨ã«Î±å¤‰æ›´ã›ãšã€ã‚°ãƒ«ãƒ¼ãƒ—å˜ä½ã§å¤‰æ›´
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å½±éŸ¿: æœ€å°é™**

---

### 4. drawGreatCircleé–¢æ•°ã®ä¿®æ­£ï¼ˆç·šåˆ†å‰²æç”»ï¼‰

#### å®Ÿè£…æ–¹é‡
- `applyDepthShading == false`: å¾“æ¥ã®æç”»ï¼ˆå¤‰æ›´ãªã—ï¼‰
- `applyDepthShading == true`: æ‰‹å‰ã¨å¥¥ã§ç·šã‚’åˆ†å‰²

#### å‡¦ç†ãƒ•ãƒ­ãƒ¼
1. å…¨ãƒã‚¤ãƒ³ãƒˆã‚’åé›†ï¼ˆ`isBackSide` ãƒ•ãƒ©ã‚°ä»˜ãï¼‰
2. æ‰‹å‰ã®ç·šã‚’æç”»ï¼ˆ`Î± = 1.0`ï¼‰
3. å¥¥ã®ç·šã‚’æç”»ï¼ˆ`Î± = 0.4`ï¼‰
4. Î±å€¤ã‚’ãƒªã‚»ãƒƒãƒˆ

#### ã‚³ãƒ¼ãƒ‰ä¾‹
```javascript
if (!applyDepthShading) {
  // å¾“æ¥ã®æç”»
  // ...
} else {
  // å…¨ãƒã‚¤ãƒ³ãƒˆã‚’åé›†
  const points = [];
  for (let i = 0; i <= steps; i++) {
    // ...
    const p = project(x, y, z);
    if (p) {
      points.push({ sx: p.sx, sy: p.sy, isBackSide: p.isBackSide });
    } else {
      points.push(null);
    }
  }
  
  // æ‰‹å‰ã®ç·šã‚’æç”»ï¼ˆÎ±=1.0ï¼‰
  ctx.globalAlpha = 1.0;
  // ...
  
  // å¥¥ã®ç·šã‚’æç”»ï¼ˆÎ±=0.4ï¼‰
  ctx.globalAlpha = 0.4;
  // ...
  
  ctx.globalAlpha = 1.0; // ãƒªã‚»ãƒƒãƒˆ
}
```

**å½±éŸ¿ã‚’å—ã‘ã‚‹é–¢æ•°**:
- `drawEcliptic()` ï¼ˆé»„é“ï¼‰
- `drawEquator()` ï¼ˆèµ¤é“ï¼‰
- `drawMeridian()` ï¼ˆå­åˆç·šï¼‰
- `drawEclipticBand()` ï¼ˆé»„é“å¸¯ï¼‰

---

### 5. è¨­å®šã®æ°¸ç¶šåŒ–

#### saveSettingsé–¢æ•°
```javascript
const settings = {
  // ...
  showBackSide: showBackSide,
  applyDepthShading: applyDepthShading, // â˜… ADDED
  planetLabelsVisible: planetLabelsVisible,
  // ...
};
```

#### loadSettingsé–¢æ•°
```javascript
showBackSide = settings.showBackSide ?? false;
applyDepthShading = settings.applyDepthShading ?? false; // â˜… ADDED
planetLabelsVisible = settings.planetLabelsVisible ?? false;
```

---

## ğŸ“Š å¤‰æ›´çµ±è¨ˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | è¿½åŠ è¡Œæ•° | å‰Šé™¤è¡Œæ•° | ç´”å¢— |
|---------|---------|---------|------|
| **scripts/sphere10.js** | +113 | -26 | +87 |

---

## ğŸ¯ è¦–è¦šåŠ¹æœ

### ãƒˆã‚°ãƒ«OFFï¼ˆé€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼‰
- å…¨è¦ç´ ãŒåŒä¸€æ˜åº¦ã§æç”»
- å¾“æ¥ã®å‹•ä½œã¨åŒã˜

### ãƒˆã‚°ãƒ«ONï¼ˆè£å´æç”» + å¥¥è¡Œãæš—åŒ–ï¼‰
| è¦ç´  | æ‰‹å‰ï¼ˆx â‰¥ 0ï¼‰ | å¥¥ï¼ˆx < 0ï¼‰ |
|------|--------------|-----------|
| **æ’æ˜Ÿ** | Î± = 1.0ï¼ˆæ˜ã‚‹ã„ï¼‰ | Î± = 0.4ï¼ˆæš—ã„ï¼‰ |
| **é»„é“** | Î± = 1.0 | Î± = 0.4 |
| **èµ¤é“** | Î± = 1.0 | Î± = 0.4 |
| **å­åˆç·š** | Î± = 1.0 | Î± = 0.4 |
| **é»„é“å¸¯** | Î± = 1.0 | Î± = 0.4 |

---

## ğŸ”§ æŠ€è¡“çš„ãªç‰¹å¾´

### 1. åº§æ¨™ç³»ã®æ­£ã—ã„ç†è§£
- **ä»•æ§˜æ›¸ã®èª¤ã‚Š**: `z < 0` ã§å¥¥å´åˆ¤å®š
- **å®Ÿè£…ã®ä¿®æ­£**: `x < 0` ã§å¥¥å´åˆ¤å®šï¼ˆXè»¸ãŒå¥¥è¡Œãï¼‰

### 2. ãƒãƒƒãƒæç”»æœ€é©åŒ–ã®ç¶­æŒ
- æ’æ˜Ÿæç”»: Î±ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã®ã‚­ãƒ¼ã«å«ã‚ã‚‹
- ã‚°ãƒ«ãƒ¼ãƒ—å˜ä½ã§Î±è¨­å®š â†’ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å½±éŸ¿æœ€å°é™

### 3. ç·šæç”»ã®åŠ¹ç‡çš„ãªåˆ†å‰²
- `applyDepthShading == false`: å¾“æ¥ã®æç”»ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãªã—ï¼‰
- `applyDepthShading == true`: æ¡ä»¶åˆ†å²ã§åˆ†å‰²æç”»

### 4. è¨­å®šã®è‡ªå‹•é€£å‹•
- `backToggle` ã®å¤‰æ›´ã§ `applyDepthShading` ã‚‚è‡ªå‹•æ›´æ–°
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯1ã¤ã®ãƒˆã‚°ãƒ«ã§ä¸¡æ–¹ã®æ©Ÿèƒ½ã‚’åˆ¶å¾¡

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆé …ç›®

### æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- âœ… **ãƒˆã‚°ãƒ«OFF**: é€šå¸¸æç”»ï¼ˆÎ± = 1.0ï¼‰
- âœ… **ãƒˆã‚°ãƒ«ON**: æ‰‹å‰ï¼ˆÎ± = 1.0ï¼‰ã€å¥¥ï¼ˆÎ± = 0.4ï¼‰
- âœ… **æ’æ˜Ÿ**: ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚Œã¦æç”»
- âœ… **ç·š**: æ‰‹å‰ã¨å¥¥ã§åˆ†å‰²æç”»
- âœ… **è¨­å®šä¿å­˜**: ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚è¨­å®šãŒä¿æŒ

### æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
- âœ… **sphere10.js**: ã‚¨ãƒ©ãƒ¼ãªã—

---

## ğŸ“ ä»•æ§˜æ›¸ã¨ã®å·®ç•°

| é …ç›® | ä»•æ§˜æ›¸ | å®Ÿè£… | ç†ç”± |
|------|--------|------|------|
| **åº§æ¨™è»¸** | `z < 0` | `x < 0` | Xè»¸ãŒå¥¥è¡Œãï¼ˆä»•æ§˜æ›¸ã®èª¤ã‚Šï¼‰ |
| **å¤‰æ•°å** | `isTransparentMode` | `showBackSide` | æ—¢å­˜å®Ÿè£…ã«åˆã‚ã›ã‚‹ |
| **ä½œæ¥­æ™‚é–“** | 4.0h | ç´„2.5h | åŠ¹ç‡çš„ãªå®Ÿè£… |

---

## ğŸš€ Gitæƒ…å ±

### ãƒ–ãƒ©ãƒ³ãƒ
- **åå‰**: `manus/depth-shading`
- **ãƒ™ãƒ¼ã‚¹**: `manus/zodiac-switch`
- **ã‚³ãƒŸãƒƒãƒˆ**: `1e76eb6`

### GitHub URL
- **ãƒ–ãƒ©ãƒ³ãƒ**: https://github.com/astrogrammar/sphere10/tree/manus/depth-shading
- **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ**: https://github.com/astrogrammar/sphere10/pull/new/manus/depth-shading

---

## ğŸ“Œ ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

### 1. Î±å€¤ã®èª¿æ•´UI
- ç¾åœ¨: Î± = 0.4ï¼ˆå›ºå®šï¼‰
- æ‹¡å¼µ: ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§0.3ã€œ0.5ã®ç¯„å›²ã§èª¿æ•´å¯èƒ½

### 2. è·é›¢ã«æ¯”ä¾‹ã—ãŸã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æš—åŒ–
```javascript
const alpha = 1 - ((x + 1) / 2) * 0.6;
```
- ç·šå½¢ã«é è¿‘æ„Ÿã‚’è¡¨ç¾
- ã‚ˆã‚Šè‡ªç„¶ãªå¥¥è¡Œãè¡¨ç¾

### 3. æ˜Ÿç­‰ç´šé€£å‹•
- æ’æ˜Ÿã®æ˜ã‚‹ã•ã‚’ç­‰ç´šã«å¿œã˜ã¦Î±åˆæˆ
- æš—ã„æ˜Ÿã¯å¥¥å´ã§ã•ã‚‰ã«æš—ã

---

## ğŸ‰ å®Ÿè£…å®Œäº†

é€æ˜åŒ–ãƒ¢ãƒ¼ãƒ‰é€£å‹•ãƒ»å¥¥è¡Œãæš—åŒ–è‡ªå‹•é©ç”¨æ©Ÿèƒ½ã®å®Ÿè£…ãŒå®Œäº†ã—ã¾ã—ãŸï¼

**å®Ÿè£…æ™‚é–“**: ç´„2.5æ™‚é–“ï¼ˆä»•æ§˜æ›¸è¦‹ç©4.0æ™‚é–“ã®62.5%ï¼‰  
**è¿½åŠ è¡Œæ•°**: 113è¡Œï¼ˆä»•æ§˜æ›¸è¦‹ç©60-80è¡Œã®ç¯„å›²å†…ï¼‰

ä»•æ§˜æ›¸ã®å•é¡Œç‚¹ã‚’ä¿®æ­£ã—ã€åŠ¹ç‡çš„ã«å®Ÿè£…ã§ãã¾ã—ãŸï¼
