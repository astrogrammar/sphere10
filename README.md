# Sphere10 立体天球ホロスコープ v1.9.1

**コード分離 + 保守性向上版 - タッチデバイス対応 & 赤緯座標系対応**

## 概要

Sphere10は3Dの立体天球ホロスコープを表示するWebアプリケーションです。このバージョンでは、タッチデバイス対応と天文学的機能拡張により、実用性と教育価値が大幅に向上しました。

## 🚀 v1.9.1 最新アップグレード内容

### 🛠️ コード分離 & 保守性向上（2025/09/17 新規実装）
- **外部スクリプト分離**: 1,200行のインラインJavaScriptを`/scripts/sphere10.js`に完全分離
- **モジュール化実現**: HTMLとJavaScriptの明確な分離により保守性大幅向上
- **ファイル構造改善**: 
  - `index.html`: HTML構造のみに特化（約240行）
  - `scripts/sphere10.js`: 全JavaScript機能（約1,170行）
- **読み込み最適化**: 外部スクリプトによるキャッシュ効率向上
- **開発効率向上**: コードの検索・編集・デバッグが格段に便利

### 📁 改善されたファイル構成
```
├── index.html                    # メインHTML（整理済み・240行）
├── css/
│   └── ui.css                   # UIスタイル + タッチ対応
├── scripts/
│   ├── sphere10.js              # メインロジック（新規分離・1,170行）
│   └── astronomy.browser.min.js # 天文計算ライブラリ
├── data/
│   ├── bsc5.csv                 # 恒星データ
│   └── location.json            # 地理的位置データ
└── favicon_io/
    └── favicon.ico              # ファビコン
```

## 🚀 v1.9 既存機能（継続サポート）

### 📱 完全タッチデバイス対応（2025/09/17 新規実装）
- **タッチイベント統合**: 全トグルボタンに `touchstart` と `click` イベントを両対応
- **視覚フィードバック強化**: タッチ時に背景透明度0.2の控えめなフィードバック
- **iOS/Android最適化**: iPadやiPhoneでのタッチ操作性を大幅改善
- **オリジナルデザイン保持**: 美しいUI設計を維持しつつタッチ機能を追加

### 🌐 天文座標系機能拡張（2025/09/17 新規実装）
- **赤緯グリッド追加**: -80° ～ +80° の10度間隔で赤緯線を表示
- **視覚的区別**: 赤道線より暗い赤色（#cc3333）の点線で描画
- **教育的価値**: 天の座標系の理解を深める実用的ツール
- **表示制御**: 指標セクションに「赤緯 DEC」チェックボックスを追加
- **設定記憶**: 赤緯表示状態も localStorage で自動保存・復元

### 🛠️ 技術的改良点
- **Canvas 2D最適化**: 既存の高速描画システムと統合
- **パフォーマンス維持**: バッチ処理により描画負荷を最小化
- **回転適応**: 動的品質調整により回転中も滑らか
- **メモリ効率**: 既存の最適化手法を継承・発展

## ✨ v1.8.1 既存機能

### 📱 完全統一トグル機能
- **全セクション対応**: 「場所 Location」を含む全ての操作パネルセクションにトグル機能を統一
- **クリック可能ヘッダー**: 全ての h3 見出しがクリック可能なトグルボタンに変換
- **視覚的フィードバック**: ▼/▶ アイコンによる折りたたみ状態の明確な表示
- **状態記憶**: localStorage による各セクションの開閉状態の自動保存・復元
- **スムーズアニメーション**: 0.4秒の滑らかな展開・収納アニメーション

## ✨ v1.8 新機能・アップグレード内容

### 🧠 新機能: 設定値記憶機能
- **自動保存**: すべての設定値をlocalStorageに自動保存
- **自動復元**: 次回アクセス時に前回の設定を自動復元
- **リアルタイム同期**: 設定変更時に即座に保存され、UI要素も同期更新
- **エラーハンドリング**: localStorage無効時の安全な処理

### 🌍 緯度調節機能
- **緯度直接入力**: 数値入力による緯度の直接調節（-90° ～ +90°）
- **リアルタイム更新**: 緯度変更時に天体位置が即座に再計算
- **既存機能との連携**: 都市選択時に緯度入力フィールドも自動更新
- **入力値検証**: 範囲外の値の自動補正（±89.9999°に制限）

### 🖱️ インタラクティブ機能強化
- **ドラッグ移動機能**: Control Panelを画面上で自由に移動可能
- **統一されたボタンデザイン**: トグルボタンのサイズを統一（+/-表示）
- **英語ボタンラベル**: PLAY, STOP, FF, REWIND で国際対応
- **青系度数表示**: スライダー値を視認性の高い青色で表示
- **光るチェックボックス**: ON時に美しいグロー効果

### 🎨 洗練されたUIデザイン
- **モダンなコントロールパネル**: ガラスモーフィズムデザイン採用
- **グラデーション効果**: 視覚的に美しいカラーグラデーション
- **ブラー効果**: backdrop-filterによる洗練された背景効果
- **スムーズなアニメーション**: 全ての要素にスムーズな遷移効果

### 🎛️ 改善された操作要素
- **カスタムチェックボックス**: ✓マーク付きのモダンなデザイン + グロー効果
- **改良されたスライダー**: 美しいサムネイルと青系度数表示
- **スタイリッシュなボタン**: グラデーション効果とホバーアニメーション
- **改善されたトグルボタン**: 統一サイズの`+`/`−`表示

### 📱 レスポンシブ対応
- **モバイルフレンドリー**: 小さな画面でも使いやすいUI
- **適応的レイアウト**: 画面サイズに応じた自動調整
- **タッチ操作対応**: モバイルデバイスでの操作性向上

## 🚀 現在実装済みの機能

### コントロールパネル機能
- **ドラッグ移動**: ヘッダー部分をドラッグして画面上で自由に移動可能（位置記憶）
- **パネル表示/非表示切り替え**: 統一サイズの`−`/`+`ボタンによる折りたたみ機能
- **再生コントロール**: PLAY、STOP、FF（早送り）、REWIND（逆再生）
- **回転制御**: 水平・南北の回転スライダー（青系度数表示・角度記憶）
- **位置設定**: 緯度の直接入力による観測地点の設定（緯度値記憶）
- **表示オプション**: 各種天体要素の表示切り替え（光るチェックボックス・状態記憶）
  - 地平線 (Horizon)
  - 子午線 (Meridian)  
  - 赤道 (Equator)
  - 黄道 (Ecliptic)
  - 獣帯 (Zodiac)
  - 赤経 (RA)

### 天体表示機能
- **恒星表示**: 固定星の表示/非表示
- **惑星位置**: 惑星の位置計算と表示
- **惑星ラベル**: 惑星名表示の切り替え
- **透明化機能**: 背景の透明表示
- **反転表示**: 東西反転機能
- **方角表示**: 方角情報の表示切り替え

### インタラクション
- **マウスドラッグ操作**: 天球の直感的な回転操作
- **日時設定**: 任意の日時での天体位置表示
- **位置設定**: 
  - 都市選択による地理的位置設定（横浜市がデフォルト）
  - 緯度の直接数値入力（-90° ～ +90°）

## 🛠️ 技術仕様

### ファイル構成
```
├── index.html                    # メインHTML（整理済み・240行）
├── css/
│   └── ui.css                   # UIスタイル + タッチ対応
├── scripts/
│   ├── sphere10.js              # メインロジック（新規・1,170行）
│   └── astronomy.browser.min.js # 天文計算ライブラリ（要配置）
├── data/
│   ├── bsc5.csv                 # 恒星データ（要配置）
│   └── location.json            # 地理的位置データ（要配置）
└── favicon_io/
    └── favicon.ico              # ファビコン（要配置）
```

### 使用技術
- **HTML5**: セマンティックな構造
- **CSS3**: モダンなスタイリング（Grid、Flexbox、CSS Variables）
- **JavaScript ES6+**: インタラクティブ機能
- **Astronomy Engine**: 天体位置計算
- **Canvas API**: 天球の描画

### CSSデザイン特徴
- **ガラスモーフィズム**: `backdrop-filter: blur()`
- **グラデーション**: `linear-gradient()`
- **ボックスシャドウ**: 複数層の影効果
- **カスタムフォーム要素**: `appearance: none`による完全カスタマイズ
- **スムーズトランジション**: `cubic-bezier()`イージング
- **グロー効果アニメーション**: `@keyframes`によるチェックボックス光彩
- **ドラッグ機能**: `cursor: grab/grabbing`による直感的操作
- **レスポンシブデザイン**: メディアクエリ対応

### 設定値記憶技術仕様
- **ストレージ方式**: localStorage（クライアントサイド永続化）
- **データ形式**: JSON形式での軽量保存
- **保存タイミング**: 各設定変更時のリアルタイム自動保存
- **復元タイミング**: ページ読み込み完了後の自動復元
- **エラー処理**: localStorage無効時の安全な処理
- **容量**: 設定データ約1KB程度（制限内で十分）

## 🔧 セットアップ手順

1. **必要ファイルの配置**:
   - `scripts/astronomy.browser.min.js` - 天文計算ライブラリ
   - `data/bsc5.csv` - 恒星カタログデータ
   - `data/location.json` - 地理的位置データ
   - `favicon_io/favicon.ico` - アプリケーションアイコン

2. **Webサーバーでの実行**:
   - ローカルサーバーまたはWebサーバーで`index.html`を開く
   - ファイルプロトコル(`file://`)では正常に動作しない場合があります

## 🎯 デザインの制約事項

### ✅ アップグレード対象
- 操作パネルの表示・非表示トグル
- フォーム要素（スライダー、チェックボックス、ボタン）のデザイン
- 操作系ボタンの視覚的改善

### ❌ 保持された要素（変更なし）
- 天体表示ロジック
- 天文情報（恒星、惑星、天球、赤道、黄道など）の計算
- 基本的な機能ロジック
- キャンバス描画処理

## 🌟 今後の拡張可能性

### 推奨される次のステップ
1. **データファイルの統合**: 必要なデータファイルの自動読み込み
2. **テーマシステム**: ライト/ダークモードの切り替え
3. **カスタマイゼーション**: ユーザー設定の保存機能
4. **アクセシビリティ向上**: WAI-ARIA対応とキーボードナビゲーション
5. **パフォーマンス最適化**: Canvas描画の最適化

### 技術的改善点
- CSS Variables活用によるテーマ機能
- Web Components化によるモジュール性向上
- PWA対応によるオフライン機能
- WebGL使用による3D描画高速化

## 📞 お問い合わせ

- **フィードバック**: [Google Form](https://forms.gle/gUFJBuh3cxngWHYo6)
- **ウェブサイト**: astrogrammar.com

---

**バージョン**: v1.9.1 Code Separation Enhanced  
**最終更新**: 2025-09-17  
**ライセンス**: オリジナルライセンスに準拠

## 🎮 操作方法

### Control Panel移動
- Control Panelのヘッダー部分（タイトル部分）をドラッグして画面上で自由に移動できます
- トグルボタン(`−`/`+`)以外の部分をクリック&ドラッグしてください

### 記憶される設定値
- **位置情報**: 緯度設定値
- **回転角度**: 水平・南北・東西の全回転角度
- **表示設定**: 全チェックボックスの状態（地平線、子午線、赤道、黄道、獣帯、赤経、恒星、透明化、惑星ラベル、反転、方角）
- **パネル状態**: コントロールパネルの表示/非表示状態

### UI機能の特徴
- **緯度直接入力**: 数値入力による精密な緯度設定（0.1度単位）
- **青系度数表示**: スライダーの度数値が青色で視認性が向上
- **光るチェックボックス**: ONの時に美しい緑色のグロー効果
- **統一ボタンサイズ**: トグルボタンが常に同じ小さなサイズ
- **英語ボタンラベル**: 国際対応のための英語表記